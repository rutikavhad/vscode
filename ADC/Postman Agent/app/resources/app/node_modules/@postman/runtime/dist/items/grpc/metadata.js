"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.toRawMetadata = toRawMetadata;
exports.toItemMetadata = toItemMetadata;
const character_encoding_1 = require("../../lib/character-encoding");
/*
    Converts between raw metadata pairs and grpc.Metadata.
*/
function toRawMetadata(metadata) {
    const rawMetadata = [];
    for (const { key, value, disabled } of metadata) {
        if (!disabled) {
            let rawValue = String(value || '');
            if (key.toLowerCase().endsWith('-bin')) {
                if (/^[a-zA-Z0-9+/=]*\s*$/.test(rawValue)) {
                    rawValue = character_encoding_1.Base64.encode(rawValue);
                }
                else {
                    throw new Error('Metadata ending in "-bin" must be base64');
                }
            }
            rawMetadata.push([key, rawValue]);
        }
    }
    return rawMetadata;
}
function toItemMetadata(rawMetadata) {
    const metadata = [];
    for (const [key, rawValue] of rawMetadata) {
        let value;
        if (rawValue instanceof Uint8Array) {
            value = character_encoding_1.Base64.decode(rawValue);
        }
        else {
            value = rawValue;
        }
        metadata.push({ key, value });
    }
    return metadata;
}
//# sourceMappingURL=metadata.js.map