"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.unsubscriber = unsubscriber;
/**
 * Generate an unsubscribe callback that supports Symbol.dispose
 *
 * @example
 * ```ts
 * function connect() {
 *   return unsubscriber(() => {
 *     disconnect();
 *   });
 * }
 *
 * // 1. As unsubscribe function
 *
 * const unsubscribe = connect();
 * unsubscribe()
 *
 * // 2. As subscription
 *
 * const subscription = connect();
 * subscription.unsubscribe();
 *
 * // 3. With using
 *
 * using subscription = connect();
 *
 * // (automatically unsubscribes when disposed)
 * ```
 */
function unsubscriber(callback, options) {
    if (options?.signal) {
        const onAbort = () => {
            callback();
            options.signal?.removeEventListener('abort', onAbort);
        };
        options.signal.addEventListener('abort', onAbort);
    }
    return Object.assign(() => {
        callback();
    }, {
        unsubscribe() {
            callback();
        },
        [Symbol.dispose]() {
            callback();
        },
    });
}
//# sourceMappingURL=unsubscribe.js.map